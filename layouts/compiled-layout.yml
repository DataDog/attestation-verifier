expires: "2024-10-10T12:23:22Z"
functionaries:
  hex-github:
    keyType: "..."
    scheme: "..."
    keyVal:
      public: "..."
  hex-builder-1:
    keyType: "..."
    scheme: "..."
    keyVal:
      public: "..."
  hex-builder-2:
    keyType: "..."
    scheme: "..."
    keyVal:
      public: "..."
  hex-npm:
    keyType: "..."
    scheme: "..."
    keyVal:
      public: "..."
steps:
  - name: "clone"
    expectedMaterials:
      - "DISALLOW *"
    expectedPredicates:
      - predicateType: "https://in-toto.io/attestation/link/v0.3"
        expectedProducts:
          - "CREATE foo*"
          - "DISALLOW *"
        functionaries:
          - "hex-builder-1"
          - "hex-builder-2"
  - name: "test"
    expectedMaterials:
      - "MATCH foo WITH products FROM clone"
      - "DISALLOW *"
    expectedPredicates:
      - predicateType: "https://in-toto.io/attestation/test-result/v0.1"
        expectedAttributes:
          - rule: "size(predicate.failedTests) == 0"
          - rule: "predicate.result == 'PASSED'"
        functionaries:
          - "hex-builder-1"
          - "hex-builder-2"
  - name: "review"
    expectedMaterials:
      - "MATCH foo WITH products FROM clone"
      - "DISALLOW *"
    expectedPredicates:
      - predicateType: "http://in-toto.io/attestation/human-review/vcs/v0.1"
        expectedAttributes:
          - rule: "size(predicate.reviewers.filter(u, u.uri == 'https://api.github.com/user/<alice-id>' || u.uri == 'https://api.github.com/user/<bob-id>' || u.uri == 'https://api.github.com/user/<carol-id>')) >= 2"
        functionaries:
          - "hex-github"
  - name: "build"
    expectedMaterials:
      - "MATCH foo WITH products FROM clone"
      - "DISALLOW *"
    expectedPredicates:
      - predicateType: "http://slsa.dev/provenance/v1"
        expectedProducts:
          - "CREATE dist/*"
          - "DISALLOW *"
        expectedAttributes:
          - rule: "predicate.runDetails.builder.id == 'https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@refs/tags/v1.4.0'"
        functionaries:
          - "hex-builder-1"
          - "hex-builder-2"
        threshold: 2
  - name: "deploy"
    expectedMaterials:
      - "MATCH dist/* WITH products FROM build"
    expectedPredicates:
      - predicateType: "https://github.com/npm/attestation/tree/main/specs/publish/v0.1"
        expectedProducts:
          - "CREATE pkg:npm/@fooproject/foo@*"
          - "DISALLOW *"
        expectedAttributes:
          - rule: "predicate.name == '@fooproject/foo'"
          - rule: "predicate.registry == 'https://registry.npmjs.org'"
        functionaries:
          - "npm"
